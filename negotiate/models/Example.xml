<?xml version="1.0" encoding="UTF-8"?>
<taskModel xmlns="http://www.cs.wpi.edu/~rich/cetask/cea-2018-ext"
           xmlns:disco="urn:disco.wpi.edu:Disco"
           xmlns:n="urn:negotiate.limsi.fr:Negotiate"
           about="urn:negotiate.limsi.fr:Example">
   <task id="_another_example">
      <subtasks id="__another_example_subtasks">
         <step name="__another_example_step" task="disco:Say"/>
         <step name="__another_example_ref" task="__another_example_tree"/>
         <binding slot="$__another_example_step.text" value="&#34;What cuisine do you prefer?&#34;"/>
         <binding slot="$__another_example_step.external" value="false"/>
      </subtasks>
   </task>
   <task id="_d4e27_tree">
      <subtasks id="_d4e28_subtasks">
         <step name="_d4e28_step" task="n:fr.limsi.negotiate.lang.StatePreference"/>
         <applicable>dom &gt; 0</applicable>
         <binding slot="$_d4e28_step.external" value="false"/>
         <binding slot="$_d4e28_step.less" value="reactUser().getLess()"/>
         <binding slot="$_d4e28_step.more" value="reactUser().getMore()"/>
      </subtasks>
      <subtasks id="_d4e29_subtasks">
         <step name="_d4e29_step" task="n:fr.limsi.negotiate.lang.StatePreference"/>
         <applicable>dom &gt; 0</applicable>
         <binding slot="$_d4e29_step.external" value="false"/>
         <binding slot="$_d4e29_step.less" value="getPreference($cuisine).getLess()"/>
         <binding slot="$_d4e29_step.more" value="getPreference($cuisine).getMore()"/>
      </subtasks>
      <subtasks id="_d4e30_subtasks">
         <step name="_d4e30_step" task="n:fr.limsi.negotiate.lang.Propose"/>
         <binding slot="$_d4e30_step.external" value="false"/>
         <binding slot="$_d4e30_step.proposal"
                  value="createCriterionProposal(getLastUserPref(), false)"/>
      </subtasks>
      <subtasks id="_d4e31_subtasks">
         <step name="_d4e31_step" task="n:fr.limsi.negotiate.lang.AskPreference"/>
         <binding slot="$_d4e31_step.external" value="false"/>
         <binding slot="$_d4e31_step.less" value="askUserPref($cuisine).getLess()"/>
         <binding slot="$_d4e31_step.more" value="askUserPref($cuisine).getMore()"/>
      </subtasks>
   </task>
   <task id="__another_example_tree">
      <subtasks id="_d4e27_subtasks">
         <step name="_d4e27_step" task="n:fr.limsi.negotiate.lang.StatePreference"/>
         <step name="_d4e27_ref" task="_d4e27_tree"/>
         <binding slot="$_d4e27_step.external" value="true"/>
      </subtasks>
   </task>
   <script init="true">

    var APPLICABLE_TEST = null; // for testing
    var dom = 0;
    $negotiation = $disco.getInteraction().getSystem().getNegotiation();
    $ambiance = Packages.fr.limsi.negotiate.restaurant.Ambiance.class ;
    $cuisine = Packages.fr.limsi.negotiate.restaurant.Cuisine.class ;
    $less = Packages.fr.limsi.negotiate.restaurant.Cuisine.ITALIAN;
    $more = Packages.fr.limsi.negotiate.restaurant.Cuisine.CHINESE;
    $lastProposal = null;

    function mostPreferredCuisine() {
       return (Packages.fr.limsi.negotiate.restaurant.Cuisine.ITALIAN);
    }
    
    function leastPreferredCuisine () {   
       		return (Packages.fr.limsi.negotiate.restaurant.Cuisine.ITALIAN);  		
    }
    
    function getLastUserPref() { 
    	if (getLastUserStatement() !=null)
    		return (getLastUserStatement().getStatedPreference());
    	
    	else 
    		return null;
    }
    
    function getLastUserStatement(){
		return $negotiation.getLastUserStatement();
	}
	
	 function getLastAgentStatement(){
		return $negotiation.getLastAgentStatement();
	}
	
	 function reactUser(){
    	return($negotiation.reactUserStatement());
    }
 
 	function lastOpenProposal(){
	
		return $lastProposal;
	}
	
	function updateProposal(proposal){
		$lastProposal = proposal;
	}
    
    function getPreference(criterion){
		return ($negotiation.getRandomPreference(criterion));
	}
	
	function sameStatement(){
		if (getLastUserStatement() == null ||  getLastAgentStatement () == null)
			return false;		
		return(getLastAgentStatement().equals(getLastUserStatement()));
	}

	function askUserPref(criterion){
		return ($negotiation.askUserPreference(criterion));
	}
	
	function createCriterionProposal(criterion, who) {
			if (criterion == null)
				return null;
			else 		
				return $negotiation.criterionProposal(criterion.getMore(), who);
	}

	function createOptionProposal (option, who) {
		return $negotiation.optionProposal(option, who);
	}
      
  </script>
</taskModel>