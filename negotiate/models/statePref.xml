<?xml version="1.0" encoding="UTF-8"?>
<taskModel xmlns="http://www.cs.wpi.edu/~rich/cetask/cea-2018-ext"
           xmlns:disco="urn:disco.wpi.edu:Disco"
           xmlns:n="urn:negotiate.limsi.fr:Negotiate"
           about="urn:negotiate.limsi.fr:Example">
   <task id="Invitation">
      <subtasks id="_Invitation_subtasks">
         <step name="_Invitation_step" task="disco:Say"/>
         <step name="_Invitation_ref" task="_Invitation_tree"/>
         <binding slot="$_Invitation_step.text"
                  value="&#34;Would you like to go out with me on the town tonight?&#34;"/>
         <binding slot="$_Invitation_step.external" value="false"/>
      </subtasks>
   </task>
   <task id="_d4e3_tree">
      <subtasks id="_d4e4_subtasks">
         <step name="_d4e4_step" task="n:fr.limsi.negotiate.lang.StatePreference"/>
         <binding slot="$_d4e4_step.external" value="false"/>
         <binding slot="$_d4e4_step.less" value="reactUser().getLess()"/>
         <binding slot="$_d4e4_step.more" value="reactUser().getMore()"/>
      </subtasks>
      <subtasks id="_d4e5_subtasks">
         <step name="_d4e5_step" task="n:fr.limsi.negotiate.lang.StatePreference"/>
         <binding slot="$_d4e5_step.external" value="false"/>
         <binding slot="$_d4e5_step.less" value="getPreference($cuisine).getLess()"/>
         <binding slot="$_d4e5_step.more" value="getPreference($cuisine).getMore()"/>
      </subtasks>
      <subtasks id="_d4e6_subtasks">
         <step name="_d4e6_step" task="n:fr.limsi.negotiate.lang.Propose"/>
         <binding slot="$_d4e6_step.external" value="false"/>
         <binding slot="$_d4e6_step.proposal"
                  value="createCriterionProposal(getLastUserStatement().getMore())"/>
      </subtasks>
      <subtasks id="_d4e7_subtasks">
         <step name="_d4e7_step" task="n:fr.limsi.negotiate.lang.AskPreference"/>
         <binding slot="$_d4e7_step.external" value="false"/>
         <binding slot="$_d4e7_step.less" value="getPreference($cuisine).getLess()"/>
         <binding slot="$_d4e7_step.more" value="getPreference($cuisine).getMore()"/>
      </subtasks>
   </task>
   <task id="_Invitation_tree">
      <subtasks id="_d4e3_subtasks">
         <step name="_d4e3_step" task="n:fr.limsi.negotiate.lang.StatePreference"/>
         <step name="_d4e3_ref" task="_d4e3_tree"/>
         <binding slot="$_d4e3_step.external" value="true"/>
      </subtasks>
   </task>
   <script init="true">
    var APPLICABLE_TEST = null; // for testing
	$less =null;
	$more = null;
    $negotiation = $disco.getInteraction().getSystem().getNegotiation();
    $ambiance = Packages.fr.limsi.negotiate.restaurant.Ambiance.class ;
    $cuisine = Packages.fr.limsi.negotiate.restaurant.Cuisine.class ;
    $lastProposal = null;

	function lastOpenProposal(){
	
		return $lastProposal;
	}
	
	function updateProposal(proposal){
		$lastProposal = proposal;
	}
	
	function getLastUserStatement(){
		return $negotiation.getLastUserStatment();
	}
	
	function getPreference(criterion){
		return ($negotiation.getRandomPreference(criterion));
	}
     
    function reactUser(){
    	return($negotiation.reactUserStatement(getLastUserStatement()));
    }
  </script>
</taskModel>