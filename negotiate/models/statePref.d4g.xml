<?xml version="1.0" encoding="utf-8"?>
<model about="urn:negotiate.limsi.fr:Example"
       xmlns="http://www.cs.wpi.edu/~rich/d4g"
       xmlns:disco="urn:disco.wpi.edu:Disco"
       xmlns:n="urn:negotiate.limsi.fr:Negotiate"
       xmlns:t="http://www.cs.wpi.edu/~rich/cetask/cea-2018-ext">



<agent id="Invitation" text="Would you like to go out with me on the town tonight?">
	<do actor="user" task="n:fr.limsi.negotiate.lang.StatePreference">
		
		<do actor="agent" task="n:fr.limsi.negotiate.lang.StatePreference"
			less="reactUser().getLess()" more="reactUser().getMore()"/>

		<do actor="agent" task="n:fr.limsi.negotiate.lang.StatePreference" 
			less="getPreference($cuisine).getLess()" more="getPreference($cuisine).getMore()"/>

		  
		<do actor="agent" task="n:fr.limsi.negotiate.lang.Propose"
			proposal="createCriterionProposal(getLastUserStatement().getMore())"/> 

		<do actor="agent" task="n:fr.limsi.negotiate.lang.AskPreference"
			less="getPreference($cuisine).getLess()" more="getPreference($cuisine).getMore()"/>

	</do>

</agent>
 

<t:script init="true">
    var APPLICABLE_TEST = null; // for testing

    $negotiation = $disco.getInteraction().getSystem().getNegotiation();
    $ambiance = Packages.fr.limsi.negotiate.restaurant.Ambiance.class ;
    $cuisine = Packages.fr.limsi.negotiate.restaurant.Cuisine.class ;
    $lastProposal = null;

	function lastOpenProposal(){
	
		return $lastProposal;
	}
	
	function updateProposal(proposal){
		$lastProposal = proposal;
	}
	
	function getLastUserStatement(){
		return $negotiation.getLastUserStatment();
	}
	
	function getPreference(criterion){
		return ($negotiation.getRandomPreference(criterion));
	}
     
    function reactUser(){
    	return($negotiation.reactUserStatement(getLastUserStatement()));
    }
  </t:script>
  
</model>
